# Java-è®¾è®¡æ¨¡å¼ï¼ˆ16ï¼‰

## 1. ä»€ä¹ˆæ˜¯è¿›ç¨‹ï¼Ÿä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿä»–ä»¬ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»å—ï¼Ÿ2ï¸âƒ£ğŸ‘
::: info è€ƒç‚¹
- **è¿›ç¨‹**ï¼šè®¡ç®—æœºä¸­çš„ç¨‹åºå…³äºæŸæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯æ“ä½œç³»ç»Ÿç»“æ„çš„åŸºç¡€ã€‚
- **çº¿ç¨‹**ï¼šç¨‹åºæ‰§è¡Œæµçš„æœ€å°å•å…ƒï¼Œæ˜¯å¤„ç†å™¨è°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ã€‚
:::

::: tip æ‹“å±•
æ‰“å¼€ä½ çš„ç”µè„‘ - ä»»åŠ¡ç®¡ç†å™¨ï¼Œç¬¬ä¸€é¡¹å°±æ˜¯è¿›ç¨‹ã€‚

ä¸€ä¸ªè¿›ç¨‹ä¸‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹åªèƒ½å±äºä¸€ä¸ªè¿›ç¨‹ã€‚
:::

## 2. Java å¦‚ä½•åˆ›å»ºçº¿ç¨‹ï¼Œå¸¸ç”¨çš„æ–¹å¼æœ‰é‚£äº›ï¼Ÿ3ï¸âƒ£ğŸ’
:::info è€ƒç‚¹
å¸¸ç”¨åˆ›å»ºçº¿ç¨‹ä¸€èˆ¬æœ‰ä¸‰ç§ç§æ–¹å¼ï¼Œå…·ä½“å¦‚ä¸‹ï¼š
* ç»§æ‰¿ Thread ç±»
``` Java
// å…³é”®ä»£ç 
class MyThread extends Thread {
	@Override
    public void run(){
        System.out.println("ç»§æ‰¿ Thread ç±»åˆ›å»ºçº¿ç¨‹ã€‚");
    }
}

public class Test {
    public static void main(String[] args) {
        MyThread myThread = new MyThread();
        myThread.start();
    }
}
```

* å®ç° Runnable æ¥å£
``` Java
// å…³é”®ä»£ç 
class MyThread implements Runnable {
	@Override
    public void run(){
        System.out.println("å®ç° Runnable æ¥å£åˆ›å»ºçº¿ç¨‹ã€‚");
    }
}

public class Test_01 {
    public static void main(String[] args) {
        MyThread myThread = new MyThread();
        myThread.start();
    }
}

public class Test_02 {
    public static void main(String[] args) {
        new Thread(new Runnable() {
            @Override
            public void run() {
                System.out.println("åŒ¿åå†…éƒ¨ç±»å®ç° Runnable æ¥å£");
            }
        }).start();
    }
}

public class Test_03 {
    public static void main(String[] args) {
        new Thread(() -> {
            System.out.println("Lambdaè¡¨è¾¾å¼");
        }).start();
    }
}
```

* å®ç° Callable æ¥å£
``` Java
// å…³é”®ä»£ç 
class MyCallable implements Callable<String> {
	@Override
    public String call(){
        return "å®ç° Callable æ¥å£";
    }
}

public class Test {
    public static void main(String[] args) {
        MyCallable myCallable = new MyCallable();
        FutureTask<String> futureTask = new FutureTask<>(myCallable);

        Thread thread = new Thread(futureTask);

        // å¯åŠ¨æ–°çº¿ç¨‹
        thread.start();

        try {
            // é˜»å¡æ€§åœ°è·å¾—å¹¶å‘çº¿ç¨‹çš„æ‰§è¡Œç»“æœ
            String result = futureTask.get();
            System.out.println("çº¿ç¨‹è¿”å›å†…å®¹ï¼š" + result);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```
:::

## 3. Java ä¸­çº¿ç¨‹æœ‰å‡ ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿè¯·è¯¦è¿°ã€‚7ï¸âƒ£ğŸ“
::: info è€ƒç‚¹
![Javaçº¿ç¨‹çŠ¶æ€](/images/service/interview/java/Thread_Status.jpeg)

- **New**ï¼šåœ¨è¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œçº¿ç¨‹å¯¹è±¡å·²ç»è¢«åˆ›å»ºï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è°ƒç”¨ `start()` æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚æ­¤æ—¶ï¼Œçº¿ç¨‹å¯¹è±¡åªæ˜¯ä¸€ä¸ªæ™®é€šçš„Javaå¯¹è±¡ï¼Œè¿˜æ²¡æœ‰è¢«åˆ†é…æ“ä½œç³»ç»Ÿèµ„æºã€‚
- **Runnable**ï¼šå½“è°ƒç”¨äº†çº¿ç¨‹å¯¹è±¡çš„ `start()` æ–¹æ³•åï¼Œçº¿ç¨‹å°±è¿›å…¥äº†å°±ç»ªçŠ¶æ€ã€‚åœ¨è¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œçº¿ç¨‹å·²ç»è¢«åŠ å…¥åˆ°çº¿ç¨‹è°ƒåº¦å™¨çš„å°±ç»ªé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è¢«åˆ†é… CPU æ—¶é—´ç‰‡æ¥æ‰§è¡Œä»»åŠ¡ã€‚
- **Running**ï¼šå½“çº¿ç¨‹è·å¾—äº† CPU æ—¶é—´ç‰‡ï¼Œå¼€å§‹æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå®ƒå¤„äºè¿è¡ŒçŠ¶æ€ã€‚åœ¨è¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œçº¿ç¨‹æ­£åœ¨æ‰§è¡Œè‡ªå·±çš„ä»»åŠ¡ä»£ç ã€‚
- **Blocked**ï¼šçº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€é€šå¸¸æ˜¯å› ä¸ºæŸäº›åŸå› å¯¼è‡´äº†çº¿ç¨‹æ— æ³•ç»§ç»­æ‰§è¡Œã€‚å¸¸è§çš„é˜»å¡åŸå› åŒ…æ‹¬ç­‰å¾…I/Oæ“ä½œå®Œæˆã€ç­‰å¾…è·å–é”ã€ç­‰å¾…æ¡ä»¶æ»¡è¶³ç­‰ã€‚å½“é˜»å¡çš„åŸå› æ¶ˆå¤±åï¼Œçº¿ç¨‹ä¼šé‡æ–°è¿›å…¥å°±ç»ªçŠ¶æ€ç­‰å¾…æ‰§è¡Œã€‚
- **Waiting**ï¼šçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€æ˜¯å› ä¸ºå®ƒåœ¨æŸä¸ªå¯¹è±¡ä¸Šç­‰å¾…ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹è°ƒç”¨äº† `Object.wait()` æ–¹æ³•æˆ–è€… `Thread.join()` æ–¹æ³•æ—¶ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚åœ¨ç­‰å¾…çŠ¶æ€ä¸‹ï¼Œçº¿ç¨‹ä¼šé‡Šæ”¾æ‰å®ƒæ‰€æŒæœ‰çš„é”ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹å”¤é†’å®ƒã€‚
- **Timed Waiting**ï¼šå’Œç­‰å¾…çŠ¶æ€ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œçº¿ç¨‹åœ¨ç­‰å¾…ä¸€æ®µæ—¶é—´æˆ–è€…ç­‰å¾…æŸä¸ªæ¡ä»¶æ»¡è¶³ä¹‹å‰ä¼šè¶…æ—¶è¿”å›ã€‚ä¾‹å¦‚ï¼Œè°ƒç”¨ `Thread.sleep()` æ–¹æ³•æˆ–è€… `Object.wait(timeout)` æ–¹æ³•æ—¶ä¼šä½¿çº¿ç¨‹è¿›å…¥å®šæ—¶ç­‰å¾…çŠ¶æ€ã€‚
- **Terminated**ï¼šçº¿ç¨‹å¤„äºç»ˆæ­¢çŠ¶æ€è¡¨ç¤ºå®ƒå·²ç»æ‰§è¡Œå®Œä»»åŠ¡æˆ–è€…è¢«æå‰ä¸­æ–­ã€‚å½“çº¿ç¨‹çš„ `run()` æ–¹æ³•æ‰§è¡Œå®Œæ¯•æˆ–è€…è°ƒç”¨äº† `Thread.interrupt()` æ–¹æ³•ä¸­æ–­çº¿ç¨‹æ—¶ï¼Œçº¿ç¨‹ä¼šè¿›å…¥ç»ˆæ­¢çŠ¶æ€ã€‚
:::

## 4. Java ä¸­çº¿ç¨‹ `wait()` å’Œ `sleep()` æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ8ï¸âƒ£ğŸ«
:::info è€ƒç‚¹
- **æ–¹æ³•æ‰€å±ä¸åŒ**ï¼š`sleep()` æ–¹æ³•å±äº Thread ç±»ä¸­çš„ static æ–¹æ³•ã€‚`wait()` å±äº Object ç±»çš„æ–¹æ³•ã€‚
- **å”¤é†’æ–¹å¼ä¸åŒ**ï¼š`sleep()` å¯ä»¥åœ¨æ—¶é—´åˆ°äº†ä¹‹åè‡ªåŠ¨å”¤é†’ã€‚`wait()` éœ€è¦æ‰‹åŠ¨å”¤é†’ã€‚
- **èµ„æºå ç”¨ä¸åŒ**ï¼šè°ƒç”¨ `sleep()` åï¼Œç°æˆä¸ä¼šé‡Šæ”¾èµ„æºï¼Œè€Œ `wait()` ä¼šç›´æ¥é‡Šæ”¾ã€‚
:::

## 5. Java ä¸­çº¿ç¨‹ `run()` å’Œ `start()` æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ8ï¸âƒ£ğŸ¥
:::info è€ƒç‚¹
- **run()**ï¼š`run()` æ–¹æ³•æ˜¯çº¿ç¨‹çš„ä¸»ä½“ï¼ŒåŒ…å«äº†çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„ä»£ç ã€‚ä½†ç›´æ¥è°ƒç”¨ run() æ–¹æ³•å¹¶ä¸ä¼šå¯åŠ¨æ–°çº¿ç¨‹ï¼Œè€Œæ˜¯åƒè°ƒç”¨æ™®é€šæ–¹æ³•ä¸€æ ·åœ¨å½“å‰çº¿ç¨‹ä¸­åŒæ­¥æ‰§è¡Œ run() æ–¹æ³•ä½“å†…çš„ä»£ç ã€‚
- **start()**ï¼š`start()` æ–¹æ³•ç”¨äºå¯åŠ¨çº¿ç¨‹ï¼Œä½¿çº¿ç¨‹ä»æ–°å»ºçŠ¶æ€ï¼ˆNEWï¼‰è¿›å…¥å°±ç»ªçŠ¶æ€ï¼ˆRUNNABLEï¼‰ï¼Œç­‰å¾… JVM çš„è°ƒåº¦æ‰§è¡Œã€‚ä¸€æ—¦çº¿ç¨‹è¢«å¯åŠ¨ï¼Œå®ƒå°†æ‰§è¡Œå…¶ run() æ–¹æ³•ä¸­çš„ä»£ç ã€‚
:::
::: tip æ‹“å±•
å¯åŠ¨çº¿ç¨‹éœ€è¦è°ƒç”¨ `start()`ï¼Œå¦‚æœç›´æ¥è°ƒç”¨ `run()` æ–¹æ³•ï¼Œå°±å’Œè°ƒç”¨æ™®é€šæ–¹æ³•æ— å·®ã€‚
:::

## 6. å¦‚ä½•åœæ­¢ä¸€ä¸ªçº¿ç¨‹ï¼Ÿä¸ºä»€ä¹ˆ `stop()` å’Œ `suspend()` ä¸æ¨èä½¿ç”¨ï¼Ÿé‚£åº”è¯¥ç”¨ä»€ä¹ˆï¼Ÿ8ï¸âƒ£ğŸ…
:::info è€ƒç‚¹
Java çº¿ç¨‹ä¸­ï¼Œæä¾›äº†å‡ ä¸ªæ–¹æ³•ç”¨æ¥åœæ­¢çº¿ç¨‹ï¼š`stop()`ã€`suspend()`ã€`interrupt()`ã€‚

- **stop()**ï¼šè°ƒç”¨ `stop()` æ–¹æ³•ä¼šç«‹å³åœæ­¢çº¿ç¨‹ï¼Œæ— è®ºçº¿ç¨‹ä¸­çš„ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæ¯•ï¼Œè¿™ä¼šå¯¼è‡´çº¿ç¨‹ä¸å®‰å…¨ï¼Œå¯èƒ½ä¼šåœ¨ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­é‡Šæ”¾é”èµ„æºï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜â€Œã€‚
- **suspend()**ï¼šæš‚åœå½“å‰çº¿ç¨‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¼šå’Œ `resume()` ä¸€åŒä½¿ç”¨ï¼Œä¸ç„¶å¾ˆå®¹æ˜“å‘ç”Ÿæ­»é”ã€‚
- **interrupt()**ï¼š`interrupt()` æ–¹æ³•ç”¨äºè¯·æ±‚ç»ˆæ­¢çº¿ç¨‹ï¼Œä¸ä¼šç«‹å³åœæ­¢çº¿ç¨‹ï¼Œè€Œæ˜¯è®¾ç½®ä¸€ä¸ªä¸­æ–­æ ‡å¿—ã€‚çº¿ç¨‹å†…éƒ¨é€šè¿‡æ£€æŸ¥ä¸­æ–­æ ‡å¿—æ¥å†³å®šæ˜¯å¦å®‰å…¨åœ°åœæ­¢æ‰§è¡Œï¼Œè¿™æ ·å¯ä»¥ä¿è¯èµ„æºæ­£ç¡®é‡Šæ”¾ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´å’Œæ­»é”é—®é¢˜â€Œã€‚
:::

## 7. å¦‚ä½•ä¿è¯çº¿ç¨‹æŒ‰ç…§é¡ºåºæ‰§è¡Œï¼Ÿ8ï¸âƒ£ğŸ«’
:::info è€ƒç‚¹
- **join()**ï¼šè¯¥æ–¹æ³•ä¸º Theard çš„æ–¹æ³•ï¼Œä½œç”¨æ˜¯è°ƒç”¨çº¿ç¨‹éœ€ç­‰å¾…è¯¥ join() çº¿ç¨‹æ‰§è¡Œå®Œæˆåï¼Œæ‰èƒ½ç»§ç»­ç”¨ä¸‹è¿è¡Œã€‚
æˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç 
```java
Thread thread1 = new Thread(new Runnable() {
    @Override
    public void run() {
        System.out.println("å…ˆç‚’å¥½é¸¡è›‹ï¼Œç››å‡ºæ¥ã€‚");
    }
});
Thread thread2 = new Thread(new Runnable() {
    @Override
    public void run() {
        try {
            thread1.join();
            System.out.println("ç‚’è¥¿çº¢æŸ¿ï¼Œç„¶åæ”¾åˆšåˆšçš„é¸¡è›‹ã€‚");
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
});
Thread thread3 = new Thread(new Runnable() {
    @Override
    public void run() {
        try {
            thread2.join();
            System.out.println("å¥½äº†ï¼Œåšå¥½äº†ã€‚");
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
});
System.out.println("åšç‚’é¸¡è›‹ã€‚");
thread3.start();
thread2.start();
thread1.start();
```
æµ‹è¯•ç»“æœï¼š
> åšç‚’é¸¡è›‹ã€‚
> å…ˆç‚’å¥½é¸¡è›‹ï¼Œç››å‡ºæ¥ã€‚
> ç‚’è¥¿çº¢æŸ¿ï¼Œç„¶åæ”¾åˆšåˆšçš„é¸¡è›‹ã€‚
> å¥½äº†ï¼Œåšå¥½äº†ã€‚

- **çº¿ç¨‹æ±  newSingleThreadExecutor**ï¼šå¯ä¸²è¡Œæ‰§è¡Œæ‰€æœ‰ä»»åŠ¡ã€‚
è¿˜æ˜¯ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬æ”¹é€ ä¸€ä¸‹ã€‚
```java
ExecutorService executorService = Executors.newSingleThreadExecutor(); // [!code focus]
Thread thread1 = new Thread(new Runnable() {
    @Override
    public void run() {
        System.out.println("å…ˆç‚’å¥½é¸¡è›‹ï¼Œç››å‡ºæ¥ã€‚");
    }
});
Thread thread2 = new Thread(new Runnable() {
    @Override
    public void run() {
        try {
            thread1.join();
            System.out.println("ç‚’è¥¿çº¢æŸ¿ï¼Œç„¶åæ”¾åˆšåˆšçš„é¸¡è›‹ã€‚");
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
});
Thread thread3 = new Thread(new Runnable() {
    @Override
    public void run() {
        try {
            thread2.join();
            System.out.println("å¥½äº†ï¼Œåšå¥½äº†ã€‚");
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
});
System.out.println("åšç‚’é¸¡è›‹ã€‚");
executorService.submit(thread1); // [!code focus]
executorService.submit(thread2); // [!code focus]
executorService.submit(thread3); // [!code focus]
executorService.shutdown(); // [!code focus]
```
:::

## 8. è¯·è¯´ä¸€ä¸‹åˆ›å»ºçº¿ç¨‹æ± æ ¸å¿ƒçš„å‡ ä¸ªå‚æ•°ï¼Ÿ6ï¸âƒ£ğŸ¥¥
:::info
```java
public ThreadPoolExecutor(
    int corePoolSize,
    int maximumPoolSize,
    long keepAliveTime,
    TimeUnit unit,
    BlockingQueue<Runnable> workQueue,
    ThreadFactory threadFactory,
    RejectedExecutionHandler handler
)
```
- **corePoolSize**ï¼šçº¿ç¨‹æ± ä¸­çš„æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå½“æäº¤ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹æ•°ç­‰äº corePoolSize, å³ä½¿æœ‰å…¶ä»–ç©ºé—²çº¿ç¨‹èƒ½å¤Ÿæ‰§è¡Œæ–°æ¥çš„ä»»åŠ¡, ä¹Ÿä¼šç»§ç»­åˆ›å»ºçº¿ç¨‹ï¼›å¦‚æœå½“å‰çº¿ç¨‹æ•°ä¸º corePoolSizeï¼Œç»§ç»­æäº¤çš„ä»»åŠ¡è¢«ä¿å­˜åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è¢«æ‰§è¡Œï¼›å¦‚æœæ‰§è¡Œäº†çº¿ç¨‹æ± çš„ `prestartAllCoreThreads()` æ–¹æ³•ï¼Œçº¿ç¨‹æ± ä¼šæå‰åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰æ ¸å¿ƒçº¿ç¨‹ã€‚
- **maximumPoolSize**ï¼šçº¿ç¨‹æ± ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚å¦‚æœå½“å‰é˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œä¸”ç»§ç»­æäº¤ä»»åŠ¡ï¼Œåˆ™åˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œå‰ææ˜¯å½“å‰çº¿ç¨‹æ•°å°äº maximumPoolSizeï¼›å½“é˜»å¡é˜Ÿåˆ—æ˜¯æ— ç•Œé˜Ÿåˆ—, åˆ™maximumPoolSize åˆ™ä¸èµ·ä½œç”¨, å› ä¸ºæ— æ³•æäº¤è‡³æ ¸å¿ƒçº¿ç¨‹æ± çš„çº¿ç¨‹ä¼šä¸€ç›´æŒç»­åœ°æ”¾å…¥ workQueueã€‚
- **keepAliveTime**ï¼šçº¿ç¨‹ç©ºé—²æ—¶çš„å­˜æ´»æ—¶é—´ï¼Œå³å½“çº¿ç¨‹æ²¡æœ‰ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œè¯¥çº¿ç¨‹ç»§ç»­å­˜æ´»çš„æ—¶é—´ï¼›é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å‚æ•°åªåœ¨çº¿ç¨‹æ•°å¤§äº corePoolSize æ—¶æ‰æœ‰ç”¨, è¶…è¿‡è¿™ä¸ªæ—¶é—´çš„ç©ºé—²çº¿ç¨‹å°†è¢«ç»ˆæ­¢ã€‚
- **unit**ï¼škeepAliveTimeçš„å•ä½ã€‚
- **workQueue**ï¼šç”¨æ¥ä¿å­˜ç­‰å¾…è¢«æ‰§è¡Œçš„ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ã€‚
- **threadFactory**ï¼šåˆ›å»ºçº¿ç¨‹çš„å·¥å‚ï¼Œé€šè¿‡è‡ªå®šä¹‰çš„çº¿ç¨‹å·¥å‚å¯ä»¥ç»™æ¯ä¸ªæ–°å»ºçš„çº¿ç¨‹è®¾ç½®ä¸€ä¸ªå…·æœ‰è¯†åˆ«åº¦çš„çº¿ç¨‹åã€‚
- **handler**ï¼šçº¿ç¨‹æ± çš„é¥±å’Œç­–ç•¥ï¼Œå½“é˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œä¸”æ²¡æœ‰ç©ºé—²çš„å·¥ä½œçº¿ç¨‹ï¼Œå¦‚æœç»§ç»­æäº¤ä»»åŠ¡ï¼Œå¿…é¡»é‡‡å–ä¸€ç§ç­–ç•¥å¤„ç†è¯¥ä»»åŠ¡ï¼Œé»˜è®¤ä½¿ç”¨ AbortPolicyï¼ˆç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼‰ã€‚
:::
:::tip æ‹“å±•
**workQueue**ï¼š
* ArrayBlockingQueue: åŸºäºæ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰FIFOæ’åºä»»åŠ¡ã€‚
* LinkedBlockingQueue: åŸºäºé“¾è¡¨ç»“æ„çš„é˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰FIFOæ’åºä»»åŠ¡ï¼Œååé‡é€šå¸¸è¦é«˜äº ArrayBlockingQueueã€‚
* SynchronousQueue: ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œååé‡é€šå¸¸è¦é«˜äº LinkedBlockingQueueã€‚
* PriorityBlockingQueue: å…·æœ‰ä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚

**handler**ï¼š
* AbortPolicy: ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚
* CallerRunsPolicy: ç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚
* DiscardOldestPolicy: ä¸¢å¼ƒé˜»å¡é˜Ÿåˆ—ä¸­é æœ€å‰çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡ã€‚
* DiscardPolicy: ç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼›
:::

## 9. ä»€ä¹ˆæ˜¯ Executorï¼Ÿ2ï¸âƒ£
:::info è€ƒç‚¹
Executor æ˜¯ Java å¹¶å‘ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªæ¥å£ï¼Œç”¨äºæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ã€‚å®ƒå®šä¹‰äº†ä¸€ç»„æ–¹æ³•æ¥æäº¤ä»»åŠ¡å¹¶æ‰§è¡Œå®ƒä»¬ï¼Œä»¥åŠç®¡ç†ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€å’Œç»“æœã€‚

Executor æ¥å£å…è®¸å°†ä»»åŠ¡æäº¤ç»™æ‰§è¡Œå™¨ï¼Œå®ƒå°†è´Ÿè´£åœ¨åå°çº¿ç¨‹ä¸­è¿è¡Œä»»åŠ¡å¹¶è¿”å›ç»“æœï¼ˆå¦‚æœæœ‰ï¼‰ã€‚æ‰§è¡Œå™¨å°è£…äº†çº¿ç¨‹æ± ï¼Œå¯è‡ªåŠ¨ç®¡ç†çº¿ç¨‹çš„åˆ›å»ºã€è°ƒåº¦å’Œé”€æ¯ï¼Œä»è€Œæä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹å¼æ¥ç®¡ç†å¹¶å‘ä»»åŠ¡ã€‚

åœ¨ Executor æ¡†æ¶ä¸­ï¼Œä»»åŠ¡å¯ä»¥æ˜¯å®ç°äº† Runnable æ¥å£æˆ– Callable æ¥å£çš„å¯¹è±¡ã€‚Executor æ¡†æ¶é€šè¿‡çº¿ç¨‹æ± ï¼ˆThreadPoolï¼‰æ¥ç®¡ç†è¿™äº›ä»»åŠ¡çš„æ‰§è¡Œï¼Œä»è€Œæé«˜äº†èµ„æºåˆ©ç”¨ç‡å’Œç³»ç»Ÿæ€§èƒ½ã€‚

Executor æ¡†æ¶ä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š

ä»»åŠ¡ï¼šåŒ…æ‹¬ Runnable æ¥å£å’Œ Callable æ¥å£çš„å®ç°ç±»ã€‚Runnable æ¥å£è¡¨ç¤ºæ— è¿”å›å€¼çš„ä»»åŠ¡ï¼Œè€Œ Callable æ¥å£è¡¨ç¤ºæœ‰è¿”å›å€¼çš„ä»»åŠ¡ã€‚

ä»»åŠ¡çš„æ‰§è¡Œï¼š

1. Executoræ¥å£ï¼šæ˜¯ Executor æ¡†æ¶çš„åŸºç¡€ï¼Œå®ƒå°†ä»»åŠ¡çš„æäº¤ä¸ä»»åŠ¡çš„æ‰§è¡Œåˆ†ç¦»å¼€æ¥ã€‚

2. ExecutorServiceæ¥å£ï¼šç»§æ‰¿è‡ª Executor æ¥å£ï¼Œæä¾›äº†æ›´ä¸°å¯Œçš„ä»»åŠ¡æäº¤å’Œæ‰§è¡Œæ–¹æ³•ï¼Œä»¥åŠç®¡ç†çº¿ç¨‹æ± çš„èƒ½åŠ›ã€‚ThreadPoolExecutor å’Œ ScheduledThreadPoolExecutor æ˜¯ ExecutorService æ¥å£çš„ä¸¤ä¸ªå…³é”®å®ç°ç±»ã€‚

3. å¼‚æ­¥è®¡ç®—çš„ç»“æœï¼šFuture æ¥å£å’Œå®ç°äº† Future æ¥å£çš„ FutureTask ç±»ï¼Œä»£è¡¨å¼‚æ­¥è®¡ç®—çš„ç»“æœã€‚
:::

## 10. è¯·è¯´ä¸€ä¸‹çº¿ç¨‹æ± ä¸­ `submit()` å’Œ `execute()`ï¼Ÿ3ï¸âƒ£
:::info è€ƒç‚¹
- **execute()**ï¼š`execute()` æ–¹æ³•æ˜¯ Executor æ¥å£ä¸­å®šä¹‰çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºæäº¤ä¸€ä¸ªä»»åŠ¡ç”¨äºæ‰§è¡Œã€‚å®ƒæ˜¯æœ€åŸºæœ¬çš„ä»»åŠ¡æäº¤æ–¹å¼ï¼Œé€‚ç”¨äºéœ€è¦æ‰§è¡Œ Runnable ç±»å‹çš„ä»»åŠ¡ã€‚
- **submit()**ï¼š`submit()` æ–¹æ³•æ˜¯ ExecutorService æ¥å£ä¸­å®šä¹‰çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒæ˜¯ `execute()` çš„å¢å¼ºç‰ˆæœ¬ã€‚`submit()` ä¸ä»…å¯ä»¥æäº¤ Runnable ä»»åŠ¡ï¼Œè¿˜å¯ä»¥æäº¤ Callable ä»»åŠ¡ï¼Œå¹¶ä¸”å®ƒä¼šè¿”å›ä¸€ä¸ª Futureå¯¹è±¡ï¼Œä»£è¡¨ä»»åŠ¡çš„æ‰§è¡Œç»“æœæˆ–çŠ¶æ€ã€‚
:::

## 11. Executors å¯ä»¥åˆ›å»ºé‚£äº›çº¿ç¨‹æ± ï¼Ÿ3ï¸âƒ£ğŸ¥‘
:::info è€ƒç‚¹
- **newCachedThreadPool**ï¼šç”¨äºåˆ›å»ºä¸€ä¸ªæ²¡æœ‰æ ¸å¿ƒçº¿ç¨‹ï¼ˆcorePoolSize ä¸º 0ï¼‰ä¸”æœ€å¤§çº¿ç¨‹æ•°å¯ä»¥æ¥è¿‘æ— é™çš„çº¿ç¨‹æ± ã€‚è¿™ç§çº¿ç¨‹æ± å¯ä»¥æ ¹æ®ä»»åŠ¡é‡çš„å¢åŠ åŠ¨æ€åœ°åˆ›å»ºæ–°çº¿ç¨‹ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åå›æ”¶ç©ºé—²çš„çº¿ç¨‹ã€‚
- **newFixedThreadPool()**ï¼šç”¨äºåˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ã€‚å½“æœ‰æ–°çš„ä»»åŠ¡æäº¤æ—¶ï¼Œå¦‚æœçº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œåˆ™æ–°çš„ä»»åŠ¡ä¼šè¢«æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°æœ‰çº¿ç¨‹å¯ç”¨ä¸ºæ­¢ã€‚
- **newScheduledThreadPool**ï¼šç”¨äºåˆ›å»ºæ”¯æŒå®šæ—¶å’Œå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œçš„çº¿ç¨‹æ± ã€‚å¯æ‰§è¡Œå®šæ—¶ä»»åŠ¡ã€å‘¨æœŸæ€§ä»»åŠ¡ã€å»¶è¿Ÿæ‰§è¡Œä»»åŠ¡ã€‚
- **newSingleThreadExecutor**ï¼šç”¨äºåˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªçº¿ç¨‹æ± ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰æäº¤åˆ°çº¿ç¨‹æ± çš„ä»»åŠ¡å°†æŒ‰ç…§æäº¤çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚å³ä½¿çº¿ç¨‹æ± ä¸­çš„å”¯ä¸€çº¿ç¨‹å› æŸäº›åŸå› æ„å¤–ç»ˆæ­¢ï¼Œçº¿ç¨‹æ± ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥ç»§ç»­æ‰§è¡Œåç»­çš„ä»»åŠ¡ï¼Œä»è€Œä¿è¯ä»»åŠ¡çš„é¡ºåºæ€§å’Œç¨³å®šæ€§ã€‚
- **newSingleThreadScheduledExecutor**ï¼šè°ƒåº¦çº¿ç¨‹æ± ï¼Œå®ƒä¿è¯æ‰€æœ‰è°ƒåº¦ä»»åŠ¡åœ¨å•ä¸ªçº¿ç¨‹ä¸­æŒ‰é¡ºåºæ‰§è¡Œã€‚
- **newWorkStealingPool**ï¼šJava 8 å¼•å…¥çš„ä¸€ä¸ªæ–°å‹çº¿ç¨‹æ± ï¼Œè¯¥çº¿ç¨‹æ± ä½¿ç”¨ `å·¥ä½œçªƒå–` çš„ç®—æ³•ï¼Œå¯ç”¨äºå¯å¹¶è¡ŒåŒ–ä¸”è®¡ç®—å¯†é›†å‹çš„ä»»åŠ¡ã€‚
:::
:::tip æ‹“å±•
è¯¦ç»†ä½¿ç”¨ä¸ç”¨æ³•è§ï¼š[Executors](/docs/knowledge/java/class/executors.md){target="_blank"}
:::

## 12. Executors ç”Ÿå‘½å‘¨æœŸï¼Ÿ2ï¸âƒ£
:::info è€ƒç‚¹
Executors æ˜¯ Java ä¸­å¤„ç†å¹¶å‘ä»»åŠ¡çš„å·¥å…·ç±»ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—å·¥å‚æ–¹æ³•æ¥åˆ›å»ºä¸åŒç±»å‹çš„çº¿ç¨‹æ± ã€‚ç„¶è€Œï¼Œæ­£å¦‚æ‰€æœ‰èµ„æºä¸€æ ·ï¼Œåˆ›å»ºçš„çº¿ç¨‹æ± éœ€è¦åœ¨ä¸éœ€è¦æ—¶è¿›è¡Œé€‚å½“çš„æ¸…ç†å’Œé‡Šæ”¾ï¼Œä»¥é¿å…èµ„æºæ³„éœ²ã€‚

çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

1. åˆ›å»ºï¼ˆCreateï¼‰ï¼šä½¿ç”¨ Executors ä¸­çš„å·¥å‚æ–¹æ³•æˆ– ThreadPoolExecutor çš„æ„é€ å‡½æ•°æ¥åˆ›å»ºçº¿ç¨‹æ± ã€‚

2. ä½¿ç”¨ï¼ˆUseï¼‰ï¼šåœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œä½¿ç”¨ submit æ–¹æ³•æˆ– execute æ–¹æ³•ã€‚

3. å…³é—­ï¼ˆShutdownï¼‰ï¼šå½“ä¸å†éœ€è¦çº¿ç¨‹æ± æ—¶ï¼Œè°ƒç”¨ shutdown æˆ– shutdownNow æ–¹æ³•æ¥å…³é—­çº¿ç¨‹æ± ã€‚
:::

## 13. synchronized å’Œ volatile åŒºåˆ«ï¼Ÿ5ï¸âƒ£ğŸ†
:::info è€ƒç‚¹
synchronized å’Œ volatile éƒ½æ˜¯ Java ä¸­ç”¨æ¥å®ç°å¤šçº¿ç¨‹åŒæ­¥çš„æœºåˆ¶ï¼Œä½†å®ƒä»¬åœ¨ä½¿ç”¨åœºæ™¯ã€å†…å­˜å¼€é”€å’ŒåŠŸèƒ½ä¸Šæœ‰æ‰€ä¸åŒã€‚
* å˜é‡ç‰¹æ€§ & å†…å­˜å¼€é”€

> **synchronized**ï¼šåˆ©ç”¨é”æ¥ä¿è¯åŒæ­¥ï¼Œä½¿ç”¨æ—¶æœ‰è¾ƒå¤§çš„å†…å­˜å¼€é”€ï¼Œå› ä¸ºå®ƒéœ€è¦è¿›è¡Œé”çš„ç”³è¯·ã€é‡Šæ”¾ã€ç­‰å¾…ç­‰æ“ä½œã€‚å®ƒé€‚ç”¨äºéœ€è¦åœ¨ä»£ç å—æˆ–æ–¹æ³•ä¸Šè¿›è¡ŒåŒæ­¥æ§åˆ¶çš„åœºæ™¯ã€‚

> **volatile**ï¼šåˆ©ç”¨å†…å­˜å±éšœæ¥ä¿è¯å¯è§æ€§å’Œç¦æ­¢æŒ‡ä»¤é‡æ’ï¼Œæ²¡æœ‰é”çš„å¼€é”€ã€‚å®ƒé€‚ç”¨äºåªéœ€è¦ä¿è¯å˜é‡çš„å¯è§æ€§ï¼Œè€Œä¸éœ€è¦ä¿è¯å¤šçº¿ç¨‹ä¹‹é—´çš„åŸå­æ€§æ“ä½œçš„åœºæ™¯ã€‚

* â€Œçº¿ç¨‹å®‰å…¨ & ä½¿ç”¨åœºæ™¯

> **synchronized**ï¼šå¯ä»¥ä¿è¯å¤šçº¿ç¨‹ä¸‹æ•°æ®çš„å‡†ç¡®æ€§ï¼Œé€‚ç”¨äºéœ€è¦åœ¨ä»£ç å—æˆ–è€…æ–¹æ³•ä¸Šè¿›è¡ŒåŒæ­¥æ§åˆ¶çš„åœºæ™¯ã€‚å®ƒå¯ä»¥ä¿è¯å˜é‡çš„ä¿®æ”¹å¯è§æ€§å’ŒåŸå­æ€§ã€‚

> **volatile**ï¼šåªèƒ½ä¿è¯å˜é‡çš„ä¿®æ”¹å¯è§æ€§ï¼Œä¸èƒ½ä¿è¯åŸå­æ€§ã€‚å®ƒé€‚ç”¨äºå¤šä¸ªçº¿ç¨‹å¯¹å®ä¾‹å˜é‡æ›´æ”¹çš„åœºåˆï¼Œå¯ä»¥åˆ·æ–°ä¸»å†…å­˜å…±äº«å˜é‡çš„å€¼ï¼Œä»è€Œä½¿å¾—å„ä¸ªçº¿ç¨‹å¯ä»¥è·å¾—æœ€æ–°çš„å€¼â€Œã€‚

* ç¼–è¯‘å™¨ä¼˜åŒ– & æŒ‡ä»¤é‡æ’

> **synchronized**â€Œï¼šæ ‡è®°çš„å˜é‡å¯ä»¥è¢«ç¼–è¯‘å™¨ä¼˜åŒ–ã€‚

> **volatile**ï¼šæ ‡è®°çš„å˜é‡ä¸ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œå¯ä»¥ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’ã€‚

synchronized å’Œ volatile éƒ½æ˜¯ç”¨æ¥å®ç°å¤šçº¿ç¨‹åŒæ­¥çš„æœºåˆ¶ï¼Œsynchronized å…·æœ‰æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼Œä½†åŒæ—¶ä¹Ÿæœ‰è¾ƒå¤§çš„æ€§èƒ½å¼€é”€ï¼Œé€‚ç”¨äºåœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´éœ€è¦åŒæ­¥å…±äº«å˜é‡çš„æƒ…å†µï¼›è€Œ volatile åˆ™é€‚ç”¨äºåªéœ€è¦ä¿è¯å˜é‡çš„å¯è§æ€§ï¼Œè€Œä¸éœ€è¦ä¿è¯å¤šçº¿ç¨‹ä¹‹é—´çš„åŸå­æ€§æ“ä½œçš„åœºæ™¯â€Œã€‚
:::

## 14. Java ä¸­å¸¸è§å¹¶å‘å®¹å™¨æœ‰é‚£äº›ï¼Œåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ4ï¸âƒ£ğŸ¥”
:::info è€ƒç‚¹
- **ConcurrentHashMap**ï¼šä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„HashMapå®ç°ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®ã€‚
- **CopyOnWriteArrayList**ï¼šä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ArrayListå®ç°ï¼Œé€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚
- **ConcurrentLinkedQueue**ï¼šä¸€ä¸ªé«˜æ•ˆçš„çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—ï¼Œå†…éƒ¨ä½¿ç”¨é“¾è¡¨å®ç°ï¼Œé€‚åˆFIFOåœºæ™¯ã€‚
- **BlockingQueue**ï¼šä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—ï¼Œæä¾›äº†putå’Œtakeæ–¹æ³•ä»¥æ”¯æŒé˜»å¡æ“ä½œã€‚
- **ConcurrentSkipListMap**ï¼šä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„æœ‰åºMapï¼ŒåŸºäºè·³è¡¨å®ç°ï¼Œé€‚åˆéœ€è¦æ’åºçš„å¹¶å‘åœºæ™¯ã€‚
:::

## 15. è¯·è¯´ä¸€ä¸‹ ThreadLocal æ˜¯ä»€ä¹ˆï¼Ÿ9ï¸âƒ£ğŸ¥•
:::info
ThreadLocal å«åšçº¿ç¨‹å˜é‡ï¼Œæ„æ€æ˜¯ ThreadLocal ä¸­å¡«å……çš„å˜é‡å±äºå½“å‰çº¿ç¨‹ï¼Œè¯¥å˜é‡å¯¹å…¶ä»–çº¿ç¨‹è€Œè¨€æ˜¯éš”ç¦»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥å˜é‡æ˜¯å½“å‰çº¿ç¨‹ç‹¬æœ‰çš„å˜é‡ã€‚ThreadLocal ä¸ºå˜é‡åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­éƒ½åˆ›å»ºäº†ä¸€ä¸ªå‰¯æœ¬ï¼Œé‚£ä¹ˆæ¯ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®è‡ªå·±å†…éƒ¨çš„å‰¯æœ¬å˜é‡ã€‚

ThreadLoal å˜é‡ï¼Œçº¿ç¨‹å±€éƒ¨å˜é‡ï¼ŒåŒä¸€ä¸ª ThreadLocal æ‰€åŒ…å«çš„å¯¹è±¡ï¼Œåœ¨ä¸åŒçš„ Thread ä¸­æœ‰ä¸åŒçš„å‰¯æœ¬ã€‚

å› ä¸ºæ¯ä¸ª Thread å†…æœ‰è‡ªå·±çš„å®ä¾‹å‰¯æœ¬ï¼Œä¸”è¯¥å‰¯æœ¬åªèƒ½ç”±å½“å‰ Thread ä½¿ç”¨ã€‚è¿™æ˜¯ä¹Ÿæ˜¯ ThreadLocal å‘½åçš„ç”±æ¥ã€‚
æ—¢ç„¶æ¯ä¸ª Thread æœ‰è‡ªå·±çš„å®ä¾‹å‰¯æœ¬ï¼Œä¸”å…¶å®ƒ Thread ä¸å¯è®¿é—®ï¼Œé‚£å°±ä¸å­˜åœ¨å¤šçº¿ç¨‹é—´å…±äº«çš„é—®é¢˜ã€‚
ThreadLocal æä¾›äº†çº¿ç¨‹æœ¬åœ°çš„å®ä¾‹ã€‚å®ƒä¸æ™®é€šå˜é‡çš„åŒºåˆ«åœ¨äºï¼Œæ¯ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çº¿ç¨‹éƒ½ä¼šåˆå§‹åŒ–ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„å®ä¾‹å‰¯æœ¬ã€‚ThreadLocal å˜é‡é€šå¸¸è¢«private staticä¿®é¥°ã€‚å½“ä¸€ä¸ªçº¿ç¨‹ç»“æŸæ—¶ï¼Œå®ƒæ‰€ä½¿ç”¨çš„æ‰€æœ‰ ThreadLocal ç›¸å¯¹çš„å®ä¾‹å‰¯æœ¬éƒ½å¯è¢«å›æ”¶ã€‚

æ€»çš„æ¥è¯´ï¼ŒThreadLocal é€‚ç”¨äºæ¯ä¸ªçº¿ç¨‹éœ€è¦è‡ªå·±ç‹¬ç«‹çš„å®ä¾‹ä¸”è¯¥å®ä¾‹éœ€è¦åœ¨å¤šä¸ªæ–¹æ³•ä¸­è¢«ä½¿ç”¨ï¼Œä¹Ÿå³å˜é‡åœ¨çº¿ç¨‹é—´éš”ç¦»è€Œåœ¨æ–¹æ³•æˆ–ç±»é—´å…±äº«çš„åœºæ™¯ã€‚
:::

## 16. Java ä¸­ `++` è¿ç®—æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ7ï¸âƒ£ğŸŒ½
:::info è€ƒç‚¹
`++` è¿ç®—æ–¹å¼ï¼š
1. è¯»å–å˜é‡çš„å€¼
2. å°†å€¼åŠ  1
3. ç„¶åå°†æ–°å€¼å†™å›å†…å­˜
å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼š
å‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹ A å’Œ Bï¼Œå®ƒä»¬åŒæ—¶å¯¹åŒä¸€ä¸ªå˜é‡è¿›è¡Œ `++` æ“ä½œã€‚çº¿ç¨‹ A è¯»å–äº†å˜é‡çš„å€¼ä¸º 5ï¼Œç„¶åå°†å…¶åŠ  1 å†™å›å†…å­˜ã€‚åŒæ—¶ï¼Œçº¿ç¨‹ B ä¹Ÿè¿›è¡Œäº†ç›¸åŒçš„æ“ä½œã€‚æœ€ç»ˆï¼Œè¿™ä¸ªå˜é‡çš„å€¼å¯èƒ½ä¼šè¢«é”™è¯¯åœ°å¢åŠ ä¸¤æ¬¡ï¼Œè€Œä¸æ˜¯é¢„æœŸçš„ä¸€æ¬¡â€Œã€‚
:::
::: tip æ‹“å±•
å¦‚ä½•é¿å…å¤šçº¿ç¨‹ä¸‹å¤šæ¬¡è¿ç®—çš„æƒ…å†µï¼Ÿ
* synchronized
```java
public class Counter {
    private int count = 0;
    public synchronized void increment() {
        count++;
    }
    public int getCount() {
        return count;
    }
}
```
* AtomicInteger
```java
public class Counter {
    private AtomicInteger count = new AtomicInteger(0);
    public void increment() {
        count.getAndIncrement();
    }
    public int getCount() {
        return count.get();
    }
}
```
:::